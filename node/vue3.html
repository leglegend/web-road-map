<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue.js设计与实现 | 前端学习路线</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/web-road-map/logo.png">
    <meta name="description" content="持续学习，不断学习">
    
    <link rel="preload" href="/web-road-map/assets/css/0.styles.7357bd1b.css" as="style"><link rel="preload" href="/web-road-map/assets/js/app.13fb6d60.js" as="script"><link rel="preload" href="/web-road-map/assets/js/2.1225ca4c.js" as="script"><link rel="preload" href="/web-road-map/assets/js/28.a55ffa53.js" as="script"><link rel="prefetch" href="/web-road-map/assets/js/10.12de4a8c.js"><link rel="prefetch" href="/web-road-map/assets/js/11.edbf6fbd.js"><link rel="prefetch" href="/web-road-map/assets/js/12.2033684f.js"><link rel="prefetch" href="/web-road-map/assets/js/13.8fcecd74.js"><link rel="prefetch" href="/web-road-map/assets/js/14.12d5edae.js"><link rel="prefetch" href="/web-road-map/assets/js/15.29a83edc.js"><link rel="prefetch" href="/web-road-map/assets/js/16.41b1eb54.js"><link rel="prefetch" href="/web-road-map/assets/js/17.bc1a0b98.js"><link rel="prefetch" href="/web-road-map/assets/js/18.ed7e7234.js"><link rel="prefetch" href="/web-road-map/assets/js/19.70e23482.js"><link rel="prefetch" href="/web-road-map/assets/js/20.f38e69fc.js"><link rel="prefetch" href="/web-road-map/assets/js/21.ae3a9747.js"><link rel="prefetch" href="/web-road-map/assets/js/22.3325cd4d.js"><link rel="prefetch" href="/web-road-map/assets/js/23.fcd884a4.js"><link rel="prefetch" href="/web-road-map/assets/js/24.43f49526.js"><link rel="prefetch" href="/web-road-map/assets/js/25.6b939b36.js"><link rel="prefetch" href="/web-road-map/assets/js/26.7f6156e2.js"><link rel="prefetch" href="/web-road-map/assets/js/27.0f87c827.js"><link rel="prefetch" href="/web-road-map/assets/js/3.a04893e0.js"><link rel="prefetch" href="/web-road-map/assets/js/4.6e796031.js"><link rel="prefetch" href="/web-road-map/assets/js/5.60876111.js"><link rel="prefetch" href="/web-road-map/assets/js/6.e66cf383.js"><link rel="prefetch" href="/web-road-map/assets/js/7.ebbb911e.js"><link rel="prefetch" href="/web-road-map/assets/js/8.84dc4039.js"><link rel="prefetch" href="/web-road-map/assets/js/9.73b65006.js">
    <link rel="stylesheet" href="/web-road-map/assets/css/0.styles.7357bd1b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-road-map/" class="home-link router-link-active"><!----> <span class="site-name">前端学习路线</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web-road-map/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web-road-map/guide/" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="/web-road-map/node/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/web-road-map/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="https://github.com/leglegend/web-road-map" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web-road-map/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web-road-map/guide/" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="/web-road-map/node/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/web-road-map/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="https://github.com/leglegend/web-road-map" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web-road-map/node/" aria-current="page" class="sidebar-link">笔记</a></li><li><a href="/web-road-map/node/js-advanced.html" class="sidebar-link">JavaScript高级程序设计</a></li><li><a href="/web-road-map/node/nodejs.html" class="sidebar-link">深入浅出Node.js</a></li><li><a href="/web-road-map/node/html.html" class="sidebar-link">MDN HTML教学</a></li><li><a href="/web-road-map/node/vue3.html" aria-current="page" class="active sidebar-link">Vue.js设计与实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-road-map/node/vue3.html#一、框架设计与实现" class="sidebar-link">一、框架设计与实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-road-map/node/vue3.html#第1章-权衡的艺术" class="sidebar-link">第1章 权衡的艺术</a></li><li class="sidebar-sub-header"><a href="/web-road-map/node/vue3.html#第2章-框架设计的核心要素" class="sidebar-link">第2章 框架设计的核心要素</a></li><li class="sidebar-sub-header"><a href="/web-road-map/node/vue3.html#第3章-vue-js-3-的设计思路" class="sidebar-link">第3章 Vue.js 3 的设计思路</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-road-map/node/vue3.html#二、相应系统" class="sidebar-link">二、相应系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-road-map/node/vue3.html#第4章-相应系统的作用与实现" class="sidebar-link">第4章 相应系统的作用与实现</a></li></ul></li></ul></li><li><a href="/web-road-map/node/http.html" class="sidebar-link">图解HTTP</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-js设计与实现"><a href="#vue-js设计与实现" class="header-anchor">#</a> Vue.js设计与实现</h1> <p>Vue.js官方团队成员——霍春阳著作，尤大作序推荐，一本对vue3深度解析的书，每个使用vue的前端人都该深读一遍，极力推荐！</p> <h2 id="一、框架设计与实现"><a href="#一、框架设计与实现" class="header-anchor">#</a> 一、框架设计与实现</h2> <h3 id="第1章-权衡的艺术"><a href="#第1章-权衡的艺术" class="header-anchor">#</a> 第1章 权衡的艺术</h3> <h4 id="声明式和命令式"><a href="#声明式和命令式" class="header-anchor">#</a> 声明式和命令式</h4> <p>这章讲述了Vue.js框架在设计之初的一些选择，这里提到了一些概念——<code>声明式</code>和<code>命令式</code>。命令式在我们日常编码中很是常见，比如说：为id为root的标签添加文本<code>hello world</code>并绑定一个点击事件，用代码可以非常清晰的描述这个操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelect</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'hello world'</span>
root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可以看到，声明式的整个过程都能用代码一一描述出来。而命令式，就好像我们只用告诉Vue.js我们要做什么：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>()=&gt; alert(<span class="token punctuation">'</span>ok<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Vue.js内部一定是通过声明式来完成整个操作的，但是开发者只需要关注结果。<br>
Vue.js采用了声明式框架，并不是因为声明式性能更优越，其性能并不高于命令式。例如我们通过document操作直接修改一个标签中的内容，还有比这性能更高的操作了么？没有，通过Vue.js实现这个功能，需要先找到这个标签，再通过命令式修改标签中的内容，这会损失一些性能。但是声明式更加利于代码的维护，Vue.js要做到的就是，在保持可维护性的同时让性能损失最小化。</p> <h4 id="虚拟dom-vs-innerhtml"><a href="#虚拟dom-vs-innerhtml" class="header-anchor">#</a> 虚拟DOM VS innerHTML</h4> <p>将一个标签放进页面，可以通过<code>document</code>或者<code>innerHTML</code>，Vue.js底层一定是使用了这两者之一的，但其实现的过程，是通过虚拟DOM来实现的。在比较性能之前，需要先明确一个点，操作DOM的计算量要远远高于JS层面的计算，我们可以通过他们在DOM层面的计算量+JS层面的计算量来确定性能孰优孰劣。</p> <table><thead><tr><th>阶段</th> <th>运算</th> <th>虚拟DOM</th> <th>innerHTML</th></tr></thead> <tbody><tr><td>创建页面</td> <td>JS运算</td> <td>创建VNode</td> <td>渲染HTML字符模板</td></tr> <tr><td></td> <td>DOM运算</td> <td>新建所有DOM元素</td> <td>新建所有DOM元素</td></tr> <tr><td>更新页面</td> <td>JS运算</td> <td>创建VNode+Diff</td> <td>渲染HTML字符模板</td></tr> <tr><td></td> <td>DOM运算</td> <td>必要的DOM更新</td> <td>销毁旧DOM创建新DOM</td></tr></tbody></table> <p>可以看到，在创建页面的时候，两种方法并没有太大差别，但是一但更新了页面，虚拟DOM只需要更新修改了的内容，无意性能会更好。<br>
除了性能，虚拟DOM也比直接操作模板字符串更加便捷和更容易维护。</p> <h4 id="运行时和编译时"><a href="#运行时和编译时" class="header-anchor">#</a> 运行时和编译时</h4> <p>Vue.js是一个运行时+编译时框架。我们先回忆下在用Vue写代码时的场景，HTML代码都放在<code>&lt;template&gt;</code>标签下，Vue.js会把这些HTML标签编译成一个树形结构的对象，在运行到浏览器中时，再把这些代码渲染为HTML代码放进页面中。</p> <h3 id="第2章-框架设计的核心要素"><a href="#第2章-框架设计的核心要素" class="header-anchor">#</a> 第2章 框架设计的核心要素</h3> <p>Vue3中通过<code>console.log()</code>打印出来的Ref对象不利于阅读，可通过DevTools中的Console标签下的<code>Enable custom formatters</code>选项优化提示。<br>
开发环境中需要给到开发者足够的提示，但是这些提示生产环境并用不到，这些提示会在构建资源时被移除。<br>
Rollup和webpack都支持<code>Tree-Shaking</code>功能，排除<code>dead code</code>。可通过<code>/*#__PURE__*/</code>注释配合<code>Tree-Shaking</code>的工作。<br>
Vue会根据用户的需要提供不同形式的包，例如通过script标签引入的就是一个IIFE格式的资源，或者在ESM中使用，在打包工具中使用，在Node中使用等，都可通过rollup或者webpack配置包的形式。<br>
用不到的模块，也可通过配置设置不打进包里。比如所我们不使用OptionApi，就可以设置__VUE_OPTION_API__为false来禁用。<br>
Vue提供了<code>registerErrorHandler</code>和<code>callWithErrorHandling</code>函数来注册和捕获错误。<code>app.config.errorHandler</code>也可注册统一错误处理函数。</p> <h3 id="第3章-vue-js-3-的设计思路"><a href="#第3章-vue-js-3-的设计思路" class="header-anchor">#</a> 第3章 Vue.js 3 的设计思路</h3> <p>Vue.js主要由编译器(renderer)和渲染器(compiler)组成，在完整的认识他们之前，我们可以把它们当成一个函数，先简单的阐述其功能。先来看一段简单的代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这段代码再简单不过了，给div绑定一个click事件，div中的内容是<code>click me</code>。看一下这段简单的代码Vue.js是如何实现的。<br>
对于编译器来说，<code>template</code>标签里的内容就是一串字符串，编译器会把它翻译成一个渲染函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'click me'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里面的<code>h</code>函数负责返回一个JS对象，调用<code>h</code>函数的结果就是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'click me'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>之后编译器会把<code>render</code>函数放在组件对象上：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'click me'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>render</code>函数返回的就是虚拟DOM，渲染器(renderer)负责把虚拟DOM渲染到页面上：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">renderer</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span>
  <span class="token comment">// 遍历 vnode.props 属性，将属性、事件添加到 DOM 元素</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 以 on 开头，说明是事件</span>
      el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
        key<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 事件名称</span>
        vnode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// 事件处理函数</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 处理 children</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> vnode<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果 children 是字符串，说明它是元素的文本子节点</span>
    el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果 children 是数组，则递归调用 renderer 渲染子节点，挂载到当前元素上</span>
    vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">renderer</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将元素添加到挂载点下</span>
  container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果上述的元素不是<code>div</code>，而是一个组件，那该如何处理？文章提到了组件的本质：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">MyComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'click me'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也就是说，组件返回的其实也是一个虚拟DOM，不过在处理组件前我们要先进行一部操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 调用组件函数，获取虚拟DOM</span>
  <span class="token keyword">const</span> subtree <span class="token operator">=</span> vnode<span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 调用 renderer 函数，渲染subtree</span>
  <span class="token function">renderer</span><span class="token punctuation">(</span>subtree<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这就是编译器和渲染器大概的工作原理，后续章节会详细的介绍它们。</p> <h2 id="二、相应系统"><a href="#二、相应系统" class="header-anchor">#</a> 二、相应系统</h2> <h3 id="第4章-相应系统的作用与实现"><a href="#第4章-相应系统的作用与实现" class="header-anchor">#</a> 第4章 相应系统的作用与实现</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web-road-map/node/html.html" class="prev">
        MDN HTML教学
      </a></span> <span class="next"><a href="/web-road-map/node/http.html">
        图解HTTP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web-road-map/assets/js/app.13fb6d60.js" defer></script><script src="/web-road-map/assets/js/2.1225ca4c.js" defer></script><script src="/web-road-map/assets/js/28.a55ffa53.js" defer></script>
  </body>
</html>
